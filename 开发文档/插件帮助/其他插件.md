# Astrbot One Last Kiss 风格生成器

**功能：** 本插件允许用户发送图片，并通过调用 One Last Image API 将其转换为 "One Last Kiss" 艺术风格的图片。

<GitHubCard repo=github.com/timetetng/timetetng-astrbot-plugins/tree/main/astrbot_plugin_onelastimage "desc="Astrbot One Last Kiss 风格生成器" />

<table align="center">
  <tr>
    <td align="center">
      <p><strong>原图</strong></p>
      <img src="/开发文档\images\example.jpg" alt="图片1" width="300">
    </td>
    <td align="center">
      <p><strong>效果图</strong></p>
      <img src="/开发文档\images\example2.jpg" alt="图片2" width="300">
    </td>
  </tr>
</table>



## 1. 安装

1.  在 `data/plugins` 目录下克隆本插件
    ```bash
    git clone https://github.com/timetetng/astrbot_plugin_onelastimage
    ```

2.  安装本插件所需的 Python 依赖库：
    ```bash
    uv add httpx Pillow
    ```
3.  重启 AstrBot，插件将会自动加载。

## 2. 配置

在 WebUI 修改配置项

添加自己的 `One Last Image API URL`, 不知道如何部署的可以查看我的这个项目

[**如何用 Vercel 免费部署自己的 One Last Image API 后端**](https://github.com/timetetng/one-last-image-api)

或者直接点击下面的按钮一键部署:

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2Ftimetetng%2Fone-last-image-api)

其他参数一般默认即可，详细的参数用法也可以参考[**配置参数**](###-配置参数)。

## 3\. 使用方法

本插件提供一个核心指令 `/onelast`。



### 基础用法

  * **发送图片并使用指令**
    发送 `/onelast` 并同时附带一张或多张图片。
  * **回复图片**
    在聊天中回复一张已发送的图片，并发送指令 `/onelast`。

### 高级用法 (自定义参数)

你可以在指令后跟随一个 **JSON** 格式的字符串，来覆盖默认的 API 参数。

**指令格式：**
`/onelast <参数 JSON 字符串>`

#### ⚠️ 重要提示：

  * 参数必须是**严格的 JSON** 格式，包括花括号 `{}`以及键名必须包裹在双引号 `""` 中。
  * 布尔值必须使用小写 `true` 或 `false`，不能使用大写。
  * JSON 中**不能含有空格**，这是 Astrbot 命令解析器的缺陷...

### 示例

1.  **使用默认配置生成**

      * `(发送图片)`

        `/onelast`

2.  **自定义参数 (例如开启水印并设置缩放2倍)**

      * `(发送图片)`

        `/onelast {'watermark':true,'zoom':2}`

3.  **回复图片并使用自定义参数**

      * `(引用一条图片消息)`

        `/onelast {'watermark':true,'hajimei':true}`

详细的参数用法也可以参考下面的[**配置参数**](###-配置参数)。

### 配置参数

`config` 字段接收一个 JSON 字符串，可以覆盖以下任意参数（所有参数均来自 `oneLastImageAPI.js` 中的 `defaultStyle`）：

| 参数名 | 类型 | 默认值 | 描述 |
| :--- | :--- | :--- | :--- |
| `zoom` | Number | `1` | 缩放比例 |
| `light` | Number | `0` | 亮度调整（在卷积计算前）。 |
| `shadeLimit` | Number | `108` | 阴影的阈值，值越小，阴影越多。 |
| `shadeLight` | Number | `80` | 阴影的强度。 |
| `shade` | Boolean | `true` | 是否启用阴影效果。 |
| `kuma` | Boolean | `true` | 是否启用 "Kiss" 渐变（彩色）效果。 |
| `hajimei` | Boolean | `false` | 是否使用彩色水印 |
| `watermark` | Boolean | `true` | 是否在右下角添加水印。 |
| `convoluteName` | String | `'一般'` | 卷积矩阵的名称。可选值：`'精细'`, `'一般'`, `'稍粗'`, `'超粗'`, `'极粗'`, `'浮雕'`。 |
| `convolute1Diff` | Boolean | `true` | 是否启用卷积差异计算。 |
| `convoluteName2`| String | `null` | 第二个卷积矩阵的名称（如果 `convolute1Diff` 为 true）。 |
| `lightCut` | Number | `128` | 亮部切割阈值。 |
| `darkCut` | Number | `118` | 暗部切割阈值。 |
| `denoise` | Boolean | `true` | 是否在卷积前进行一次 9 宫格降噪处理。 |
